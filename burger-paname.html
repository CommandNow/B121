
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Burger Paname V5.6</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f5f0; padding: 20px; color: #333; }
    h1, h2 { text-align: center; }
    .step { max-width: 600px; margin: 0 auto; }
    .section { margin-top: 30px; }
    select, input[type="text"], button {
      width: 100%; padding: 10px; margin: 10px 0; font-size: 16px;
    }
    .cart-item { display: flex; justify-content: space-between; padding: 5px 0; }
    .cart-item button { padding: 0 8px; }
    option[disabled] { color: gray; }
    #loading { text-align: center; font-size: 18px; padding: 20px; display: none; }
    #error { color: red; text-align: center; display: none; }
  </style>
  <script>
    let cart = [];

    async function loadOptions(sheetId, tabName, selectId, labelId, fallbackItems) {
      const url = `https://opensheet.elk.sh/${sheetId}/${tabName}`;
      const select = document.getElementById(selectId);
      const label = document.getElementById(labelId);
      const loading = document.getElementById("loading");
      const error = document.getElementById("error");

      select.innerHTML = "";
      loading.style.display = "block";
      label.textContent = tabName;

      try {
        const response = await fetch(url);
        const data = await response.json();
        loading.style.display = "none";

        const noneOption = document.createElement("option");
        noneOption.textContent = "Aucun";
        noneOption.value = "Aucun";
        select.appendChild(noneOption);

        data.forEach(item => {
          const option = document.createElement("option");
          option.value = item.Nom;
          if (parseInt(item.Stock) === 0) {
            option.textContent = `${item.Nom} - ${item.Prix}€ (rupture)`;
            option.disabled = true;
          } else {
            option.textContent = `${item.Nom} - ${item.Prix}€`;
          }
          select.appendChild(option);
        });

      } catch (e) {
        console.error(e);
        loading.style.display = "none";
        error.style.display = "block";
        fallbackItems.forEach(item => {
          const option = document.createElement("option");
          option.value = item.nom;
          option.textContent = `${item.nom} - ${item.prix}€${item.stock === 0 ? " (rupture)" : ""}`;
          option.disabled = item.stock === 0;
          select.appendChild(option);
        });
      }
    }

    function addToCart(selectId) {
      const selected = document.getElementById(selectId);
      const itemName = selected.value;
      if (itemName === "Aucun" || itemName.includes("rupture")) return;
      const existing = cart.find(i => i.name === itemName);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ name: itemName, quantity: 1 });
      }
      updateCart();
    }

    function changeQty(index, delta) {
      cart[index].quantity += delta;
      if (cart[index].quantity <= 0) cart.splice(index, 1);
      updateCart();
    }

    function updateCart() {
      const container = document.getElementById("cart");
      container.innerHTML = "";
      cart.forEach((item, index) => {
        container.innerHTML += `
          <div class="cart-item">
            <span>${item.name} x${item.quantity}</span>
            <div>
              <button onclick="changeQty(${index}, -1)">-</button>
              <button onclick="changeQty(${index}, 1)">+</button>
            </div>
          </div>`;
      });
    }

    function sendOrder() {
      const name = document.getElementById("clientName").value;
      if (!name) {
        alert("Merci de saisir votre prénom.");
        return;
      }

      let message = `Commande pour ${name} - Burger Paname :%0A`;
      cart.forEach(item => {
        message += `- ${item.name} x${item.quantity}%0A`;
      });

      const phone = "33616550952";
      window.open(`https://wa.me/${phone}?text=${message}`, "_blank");
    }

    window.onload = () => {
      const sheetId = "123Ozq3ba7_E2PZe_vunBQsOI18rcNAahhEAK8QaYd7M";
      loadOptions(sheetId, "Burgers", "burger", "label-burger", [
        { nom: "Classic Burger", prix: 10, stock: 1 },
        { nom: "Veggie Burger", prix: 9, stock: 0 }
      ]);
      loadOptions(sheetId, "Boissons", "drink", "label-drink", [
        { nom: "Coca-Cola", prix: 2, stock: 1 },
        { nom: "Fanta", prix: 2, stock: 1 }
      ]);
      loadOptions(sheetId, "Accompagnements", "fries", "label-fries", [
        { nom: "Frites", prix: 3, stock: 1 },
        { nom: "PDT sautées", prix: 3.5, stock: 1 }
      ]);
      loadOptions(sheetId, "Crudités", "crudites", "label-crudites", [
        { nom: "Salade", prix: 0, stock: 1 },
        { nom: "Tomates", prix: 0, stock: 1 }
      ]);
      loadOptions(sheetId, "Desserts", "dessert", "label-dessert", [
        { nom: "Cookie", prix: 2, stock: 1 },
        { nom: "Brownie", prix: 3.5, stock: 0 }
      ]);
    };
  </script>
</head>
<body>
<div class="tabs" style="display:flex; justify-content:center; margin-bottom:20px;">
    <a href="#commande1" style="margin:0 10px; padding:10px 20px; background:#fff; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">Commande 1</a>
    <a href="#commande2" style="margin:0 10px; padding:10px 20px; background:#fff; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">Commande 2</a>
    <a href="#commande3" style="margin:0 10px; padding:10px 20px; background:#fff; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">Commande 3</a>
</div>

  <h1>Burger Paname - V5.6</h1>
  <div id="loading">Chargement du menu...</div>
  <div id="error">Erreur de connexion au menu. Données locales affichées.</div>
  <div class="step">
    <div class="section">
      <h2 id="label-burger"></h2>
      <select id="burger"></select>
      <button onclick="addToCart('burger')">Ajouter au panier</button>
    </div>
    <div class="section">
      <h2 id="label-drink"></h2>
      <select id="drink"></select>
      <button onclick="addToCart('drink')">Ajouter au panier</button>
    </div>
    <div class="section">
      <h2 id="label-fries"></h2>
      <select id="fries"></select>
      <button onclick="addToCart('fries')">Ajouter au panier</button>
    </div>
    <div class="section">
      <h2 id="label-crudites"></h2>
      <select id="crudites"></select>
      <button onclick="addToCart('crudites')">Ajouter au panier</button>
    </div>
    <div class="section">
      <h2 id="label-dessert"></h2>
      <select id="dessert"></select>
      <button onclick="addToCart('dessert')">Ajouter au panier</button>
    </div>

    
<h2>Commande en cours</h2>
<div id="currentOrder"></div>
<button onclick="validateOrder()">Valider cette commande</button>

<h2>Commandes validées</h2>
<div id="cart"></div>

<h2>Finalisation</h2>
<input type="text" id="clientName" placeholder="Votre prénom" />
<button onclick="sendOrder()">Envoyer sur WhatsApp</button>

  </div>

<script>
let cart = [];
let currentOrder = [];
let orderNumber = 1;

function addToCart(selectId) {
  const selected = document.getElementById(selectId);
  const itemName = selected.value;
  if (itemName === "Aucun" || itemName.includes("rupture")) return;

  const existing = currentOrder.find(i => i.name === itemName);
  if (existing) {
    existing.quantity++;
  } else {
    currentOrder.push({ name: itemName, quantity: 1 });
  }
  updateCurrentOrder();
}

function updateCurrentOrder() {
  const container = document.getElementById("currentOrder");
  container.innerHTML = "";
  currentOrder.forEach((item, index) => {
    container.innerHTML += `
      <div class="cart-item">
        <span>${item.name} x${item.quantity}</span>
        <div>
          <button onclick="changeQty(${index}, -1)">-</button>
          <button onclick="changeQty(${index}, 1)">+</button>
        </div>
      </div>`;
  });
}

function changeQty(index, delta) {
  currentOrder[index].quantity += delta;
  if (currentOrder[index].quantity <= 0) currentOrder.splice(index, 1);
  updateCurrentOrder();
}

function validateOrder() {
  if (currentOrder.length === 0) {
    alert("Ajoutez des articles à la commande.");
    return;
  }
  cart.push({ orderNumber: orderNumber++, items: [...currentOrder] });
  currentOrder = [];
  updateCurrentOrder();
  updateCart();
}

function updateCart() {
  const container = document.getElementById("cart");
  container.innerHTML = "";
  cart.forEach(order => {
    container.innerHTML += `<h3 style="margin-top: 20px;">Commande ${order.orderNumber}</h3>`;
    order.items.forEach(item => {
      container.innerHTML += `<div class="cart-item">${item.name} x${item.quantity}</div>`;
    });
  });
}

function sendOrder() {
  const name = document.getElementById("clientName").value;
  if (!name) {
    alert("Merci de saisir votre prénom.");
    return;
  }

  let message = `Commande pour ${name} - Burger Paname :%0A`;
  cart.forEach(order => {
    message += `Commande ${order.orderNumber}:%0A`;
    order.items.forEach(item => {
      message += `- ${item.name} x${item.quantity}%0A`;
    });
    message += "%0A";
  });

  const phone = "33616550952";
  window.open(`https://wa.me/${phone}?text=${message}`, "_blank");
}
</script>

</body>
</html>
